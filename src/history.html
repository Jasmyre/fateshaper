<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Match History - Fateshaper</title>
  <link rel="stylesheet" href="/utils.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/utils.css">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Rajdhani', 'sans-serif'],
            display: ['Orbitron', 'sans-serif'],
          },
          colors: {
            primary: "#6d28d9",
            secondary: "#10b981",
            dark: "#0f172a",
            light: "#f8fafc",
          }
        },
      },
    };
  </script>
  <script src="ts/scroll_animation.ts" type="module"></script>
  <style>
    body {
      background-color: #0f172a;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
    }
    .class-badge {
      @apply px-2 py-1 rounded-full text-xs font-medium;
    }
    .assassin-badge {
      @apply bg-primary/20 text-primary;
    }
    .defender-badge {
      @apply bg-secondary/20 text-secondary;
    }
    .healer-badge {
      @apply bg-blue-500/20 text-blue-500;
    }
    .rogue-badge {
      @apply bg-purple-500/20 text-purple-400;
    }
    .warrior-badge {
      @apply bg-red-500/20 text-red-400;
    }
  </style>
</head>
<body class="text-white min-h-screen flex flex-col">
  <header class="bg-dark/80 backdrop-blur-sm sticky top-0 z-50 border-b border-primary/20">
    <div class="container mx-auto px-4 max-w-screen-xl">
      <nav class="flex justify-between items-center py-4">
        <a href="/index.html" class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
          <span class="text-2xl font-display font-bold text-white">Fateshaper</span>
        </a>
        
        <ul class="hidden md:flex space-x-8 font-medium">
          <li><a href="/index.html" class="text-white hover:text-primary transition-colors">Home</a></li>
          <li><a href="information.html" class="text-white hover:text-primary transition-colors">Information</a></li>
          <li><a href="game.html" class="text-white hover:text-primary transition-colors">Game</a></li>
          <li><a href="gallery.html" class="text-white hover:text-primary transition-colors">Gallery</a></li>
          <li><a href="contact.html" class="text-white hover:text-primary transition-colors">Contact</a></li>
        </ul>
        
        <button id="menu-toggle" class="md:hidden text-white focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </nav>
    </div>

    <div id="mobile-menu" class="hidden md:hidden bg-dark/95 backdrop-blur-md">
      <ul class="flex flex-col items-center py-4 space-y-4 font-medium">
        <li><a href="/index.html" class="text-white hover:text-primary transition-colors">Home</a></li>
        <li><a href="information.html" class="text-white hover:text-primary transition-colors">Information</a></li>
        <li><a href="game.html" class="text-white hover:text-primary transition-colors">Game</a></li>
        <li><a href="gallery.html" class="text-white hover:text-primary transition-colors">Gallery</a></li>
        <li><a href="contact.html" class="text-white hover:text-primary transition-colors">Contact</a></li>
      </ul>
    </div>
  </header>

  <main class="flex-grow py-16 min-h-svh">
    <div class="container mx-auto px-4 max-w-screen-xl">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-display font-bold mb-4">
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">
            Match History
          </span>
        </h1>
        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
          Review your past battles, analyze your performance, and track your progress over time.
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
        <div class="bg-dark/50 backdrop-blur-sm p-6 rounded-xl border border-primary/20 fade-in scale-in">
          <div class="flex items-center gap-3 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
              <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
              <path d="M4 22h16"></path>
              <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
              <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
              <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
            <h2 class="text-xl font-bold">Total Wins</h2>
          </div>
          <p class="text-3xl font-bold text-primary" id="total-wins">0</p>
        </div>
        
        <div class="bg-dark/50 backdrop-blur-sm p-6 rounded-xl border border-primary/20 fade-in scale-in">
          <div class="flex items-center gap-3 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
              <path d="M12 9v4"></path>
              <path d="M12 17h.01"></path>
            </svg>
            <h2 class="text-xl font-bold">Total Losses</h2>
          </div>
          <p class="text-3xl font-bold text-red-500" id="total-losses">0</p>
        </div>
        
        <div class="bg-dark/50 backdrop-blur-sm p-6 rounded-xl border border-primary/20 scale-in">
          <div class="flex items-center gap-3 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-secondary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <h2 class="text-xl font-bold">Win Rate</h2>
          </div>
          <p class="text-3xl font-bold text-secondary" id="win-rate">0%</p>
        </div>
        
        <div class="bg-dark/50 backdrop-blur-sm p-6 rounded-xl border border-primary/20 fade-in scale-in">
          <div class="flex items-center gap-3 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2v20"></path>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            <h2 class="text-xl font-bold">Highest Score</h2>
          </div>
          <p class="text-3xl font-bold text-amber-500" id="highest-score">0</p>
        </div>
      </div>
      
      <div class="bg-dark/50 backdrop-blur-sm rounded-xl border border-primary/20 overflow-hidden mb-12 fade-in">
        <div class="p-6 border-b border-primary/20 flex justify-between items-center">
          <h2 class="text-2xl font-display font-bold">Recent Matches</h2>
          <div class="flex items-center gap-4">
            <button id="clear-history" class="text-sm text-red-500 hover:text-red-400 transition-colors flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"></path>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Clear History
            </button>
            <button id="export-history" class="text-sm text-secondary hover:text-secondary/80 transition-colors flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Export Data
            </button>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="bg-primary/10 text-left">
                <th class="p-4 font-bold">Date</th>
                <th class="p-4 font-bold">Class</th>
                <th class="p-4 font-bold">Opponent</th>
                <th class="p-4 font-bold">Result</th>
                <th class="p-4 font-bold">Score</th>
                <th class="p-4 font-bold">Rounds</th>
                <th class="p-4 font-bold">Duration</th>
                <th class="p-4 font-bold">Details</th>
              </tr>
            </thead>
            <tbody id="match-history-body">
            </tbody>
          </table>
        </div>
      </div>
    
      <div class="flex justify-center mb-12">
        <nav class="flex items-center gap-2" id="pagination-controls">
        </nav>
      </div>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/class-selection" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-xl transition-all transform hover:scale-105 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 12H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
          </svg>
          New Game
        </a>
      </div>
    </div>
  </main>

  <footer class="border-t border-violet-500/20 py-8 mt-auto">
    <div class="container mx-auto px-4 max-w-screen-xl text-center text-gray-400">
      <p>&copy; 2024 Fateshaper. All rights reserved.</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');

      if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });
      }

      const MATCHES_PER_PAGE = 10;
      let currentPage = 1;
      let allMatches = [];

      function initHistory() {
        loadMatches();
        setupEventListeners();
      }

      function loadMatches() {
        try {
          const exampleData = [{
            "gameId": "1742822648983",
            "startTime": "2025-03-24T13:24:08.983Z",
            "playerClass": "Assassin",
            "robotClass": "Rogue",
            "rounds": [],
            "endTime": "2025-03-24T13:34:02.316Z",
            "finalScores": {
              "playerScore": 3509,
              "robotScore": 1661
            },
            "outcome": "player"
          }];
          
          const savedMatches = localStorage.getItem('gameHistory');
          allMatches = savedMatches ? JSON.parse(savedMatches).reverse() : exampleData.reverse();
          
          updateStatistics();
          renderMatches();
          renderPagination();
        } catch (error) {
          console.error('Error loading match history:', error);
          alert('Error loading match history. See console for details.');
        }
      }

      function updateStatistics() {
        const totalWins = allMatches.filter(game => game.outcome === 'player').length;
        const totalLosses = allMatches.filter(game => game.outcome === 'robot').length;
        const winRate = totalWins + totalLosses > 0 ? 
          (totalWins / (totalWins + totalLosses) * 100) : 0;
        const highestScore = allMatches.length > 0 ? 
          Math.max(...allMatches.map(game => game.finalScores?.playerScore || 0)) : 0;

        document.getElementById('total-wins').textContent = totalWins;
        document.getElementById('total-losses').textContent = totalLosses;
        document.getElementById('win-rate').textContent = `${winRate.toFixed(1)}%`;
        document.getElementById('highest-score').textContent = highestScore;
      }

      function renderMatches() {
        const tbody = document.getElementById('match-history-body');
        
        if (allMatches.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="8" class="p-8 text-center text-gray-400">
                No match history found. Play some games to see your stats here!
              </td>
            </tr>
          `;
          return;
        }
        
        const startId = (currentPage - 1) * MATCHES_PER_PAGE;
        const endId = startId + MATCHES_PER_PAGE;
        const matchesToShow = allMatches.slice(startId, endId);

        tbody.innerHTML = matchesToShow.map(game => {
          const duration = game.endTime ? 
            formatDuration(new Date(game.endTime) - new Date(game.startTime)) : 'N/A';
          
          return `
            <tr class="border-t border-primary/10 hover:bg-dark/30 transition-colors ">
              <td class="p-4 text-gray-300">${formatDate(game.startTime)}</td>
              <td class="p-4">
                <span class="class-badge ${getClassBadgeStyle(game.playerClass)}">
                  ${game.playerClass}
                </span>
              </td>
              <td class="p-4">
                <span class="class-badge ${getClassBadgeStyle(game.robotClass)}">
                  ${game.robotClass}
                </span>
              </td>
              <td class="p-4">
                <span class="${game.outcome === 'player' ? 'text-green-500' : 'text-red-500'} font-bold">
                  ${game.outcome === 'player' ? 'Victory' : 'Defeat'}
                </span>
              </td>
              <td class="p-4 text-gray-300">${game.finalScores?.playerScore || 'N/A'}</td>
              <td class="p-4 text-gray-300">${game.rounds?.length || 'N/A'}</td>
              <td class="p-4 text-gray-300">${duration}</td>
              <td class="p-4">
                <a href="details.html?gameId=${game.gameId}" class="text-primary hover:text-primary/80 transition-colors">
                  View
                </a>
              </td>
            </tr>
          `;
        }).join('');
      }

      function renderPagination() {
        const paginationContainer = document.getElementById('pagination-controls');
        const totalPages = Math.ceil(allMatches.length / MATCHES_PER_PAGE);
        
        if (totalPages <= 1) {
          paginationContainer.innerHTML = '';
          return;
        }

        let paginationHTML = `
          <button onclick="changePage(${currentPage - 1})" 
            class="w-10 h-10 flex items-center justify-center rounded-lg border border-primary/30 text-gray-400 hover:border-primary hover:text-primary transition-colors ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6"/>
            </svg>
          </button>
        `;

        if (currentPage > 2) {
          paginationHTML += `
            <button onclick="changePage(1)" 
              class="w-10 h-10 flex items-center justify-center rounded-lg border border-primary/30 text-gray-400 hover:border-primary hover:text-primary transition-colors">
              1
            </button>
          `;
        }

        if (currentPage > 3) {
          paginationHTML += `
            <span class="w-10 h-10 flex items-center justify-center text-gray-400">...</span>
          `;
        }

        for (let i = Math.max(1, currentPage - 1); i <= Math.min(totalPages, currentPage + 1); i++) {
          paginationHTML += `
            <button onclick="changePage(${i})" 
              class="w-10 h-10 flex items-center justify-center rounded-lg ${currentPage === i ? 'bg-primary text-white' : 'border border-primary/30 text-gray-400 hover:border-primary hover:text-primary'} transition-colors">
              ${i}
            </button>
          `;
        }

        if (currentPage < totalPages - 2) {
          paginationHTML += `
            <span class="w-10 h-10 flex items-center justify-center text-gray-400">...</span>
          `;
        }

        if (totalPages > 1 && currentPage < totalPages - 1) {
          paginationHTML += `
            <button onclick="changePage(${totalPages})" 
              class="w-10 h-10 flex items-center justify-center rounded-lg border border-primary/30 text-gray-400 hover:border-primary hover:text-primary transition-colors">
              ${totalPages}
            </button>
          `;
        }

        paginationHTML += `
          <button onclick="changePage(${currentPage + 1})" 
            class="w-10 h-10 flex items-center justify-center rounded-lg border border-primary/30 text-gray-400 hover:border-primary hover:text-primary transition-colors ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </button>
        `;

        paginationContainer.innerHTML = paginationHTML;
      }

      window.changePage = function(newPage) {
        const totalPages = Math.ceil(allMatches.length / MATCHES_PER_PAGE);
        if (newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
          currentPage = newPage;
          renderMatches();
          renderPagination();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      };

      function formatDate(dateString) {
        try {
          const date = new Date(dateString);
          return date.toLocaleDateString('tl-PH', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
        } catch (e) {
          return dateString.split('T')[0];
        }
      }

      function formatDuration(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        
        if (minutes > 0) {
          return `${minutes}m ${remainingSeconds}s`;
        }
        return `${seconds}s`;
      }

      function getClassBadgeStyle(className) {
        const styles = {
          'Assassin': 'assassin-badge',
          'Defender': 'defender-badge',
          'Healer': 'healer-badge',
          'Rogue': 'rogue-badge',
          'Warrior': 'warrior-badge'
        };
        return styles[className] || 'bg-gray-500/20 text-gray-300';
      }

      function setupEventListeners() {
        document.getElementById('clear-history')?.addEventListener('click', () => {
          if (confirm('Are you sure you want to clear your match history? This cannot be undone.')) {
            localStorage.removeItem('gameHistory');
            allMatches = [];
            currentPage = 1;
            updateStatistics();
            renderMatches();
            renderPagination();
          }
        });

        document.getElementById('export-history')?.addEventListener('click', () => {
          if (allMatches.length === 0) {
            alert('No match history to export.');
            return;
          }

          const dataStr = JSON.stringify(allMatches, "\t", 2);
          const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
          
          const exportFileDefaultName = `fateshaper-history-${new Date().toISOString().split('T')[0]}.json`;
          
          const linkElement = document.createElement('a');
          linkElement.setAttribute('href', dataUri);
          linkElement.setAttribute('download', exportFileDefaultName);
          linkElement.click();
        });
      }
      initHistory();
    });
  </script>
</body>
</html>